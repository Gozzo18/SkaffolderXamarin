**** PROPERTIES SKAFFOLDER ****
{
    "forEachObj": "resource",
    "overwrite": true,
    "_partials": []
}
**** END PROPERTIES SKAFFOLDER ****
using SkaffolderTemplate.Models;
using SkaffolderTemplate.Views.Edit;
using System.Collections.ObjectModel;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace SkaffolderTemplate.Views.Loading
{
    [XamlCompilation(XamlCompilationOptions.Compile)]
	public partial class {{capitalize resource.name}}LoadingView : ContentPage
	{
        private {{capitalize resource.name}} {{lowercase resource.name}};
        {{#each resource._entity._relations}}{{#equal type "m:m"}}{{#equal ./../resource._entity._id _ent1._id}}
        private ObservableCollection<{{_ent2.name}}> {{lowercase _ent2.name}}s;
        {{/equal}}{{/equal}}{{/each}}

		public {{capitalize resource.name}}LoadingView ({{capitalize resource.name}} {{lowercase resource.name}}ToEdit)
		{
            {{lowercase resource.name}} = {{lowercase resource.name}}ToEdit;
            {{#each resource._entity._relations}}{{#equal type "m:m"}}{{#equal ./../resource._entity._id _ent1._id}}
            {{lowercase _ent2.name}}s = new ObservableCollection<{{_ent2.name}}>();
            {{/equal}}{{/equal}}{{/each}}
			InitializeComponent();
		}

        //Load data that will be used by {{capitalize resource.name}}Edit
        protected override async void OnAppearing()
        {
            if ({{lowercase resource.name}} != null)
            {
                {{#each resource._entity._relations}}{{#equal type "m:m"}}{{#equal ./../resource._entity._id _ent1._id}}
                foreach (string {{lowercase _ent2.name}}Id in {{lowercase ./../resource.name}}.{{capitalize name}})
                {
                     {{lowercase _ent2.name}}s.Add(await App. {{lowercase _ent2.name}}Service.GETId({{lowercase _ent2.name}}Id));
                }{{/equal}}{{/equal}}{{/each}}
                var masterDetailPage = App.Current.MainPage as MasterDetailPage;
                await masterDetailPage.Detail.Navigation.PushAsync(new {{capitalize resource.name}}Edit({{lowercase resource.name}}{{#each resource._entity._relations}}{{#equal type "m:m"}}{{#equal ./../resource._entity._id _ent1._id}},  {{lowercase _ent2.name}}s{{/equal}}{{/equal}}{{/each}}), false);
            }
            else
            {
                var masterDetailPage = App.Current.MainPage as MasterDetailPage;
                await masterDetailPage.Detail.Navigation.PushAsync(new {{capitalize resource.name}}Edit(null{{#each resource._entity._relations}}{{#equal type "m:m"}}{{#equal ./../resource._entity._id _ent1._id}}, null{{/equal}}{{/equal}}{{/each}}), false);
            }
            this.OnDisappearing();
        
        }
    }
}